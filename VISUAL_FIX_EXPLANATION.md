# –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞: –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ (—Å–µ–∫—É–Ω–¥—ã)                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

t=0s    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–ü—Ä–∏–≤–µ—Ç!"
        ‚îÇ
        ‚îú‚îÄ‚îÄ> 1. –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ) ‚úÖ
        ‚îÇ    [UI: "–ü—Ä–∏–≤–µ—Ç!"]
        ‚îÇ
        ‚îî‚îÄ‚îÄ> 2. AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
             ‚îî‚îÄ> action: aic_send_message
                 message: "–ü—Ä–∏–≤–µ—Ç!"
                 session_id: "session_123"

t=0.5s  –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç
        ‚îÇ
        ‚îî‚îÄ‚îÄ> response: {success: true, message_id: 42}
             ‚îÇ
             ‚ùå –ë–ê–ì: lastMessageId –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è!
             lastMessageId = 0 (–æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º)

t=3s    Polling –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        ‚îÇ
        ‚îú‚îÄ‚îÄ> GET messages WHERE id > 0
        ‚îÇ    (lastMessageId = 0, –ø–æ—ç—Ç–æ–º—É –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—Å–µ)
        ‚îÇ
        ‚îî‚îÄ‚îÄ> –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: [{id: 42, text: "–ü—Ä–∏–≤–µ—Ç!"}]
             ‚îÇ
             ‚îî‚îÄ‚îÄ> 3. –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –°–ù–û–í–ê ‚ùå
                  [UI: "–ü—Ä–∏–≤–µ—Ç!", "–ü—Ä–∏–≤–µ—Ç!"]
                  
                  üî¥ –î–£–ë–õ–ò–ö–ê–¢!

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ò–¢–û–ì: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ 2 —Ä–∞–∑–∞             ‚îÇ
‚îÇ ‚Ä¢ t=0s   - –ø–µ—Ä–≤—ã–π —Ä–∞–∑ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ)        ‚îÇ
‚îÇ ‚Ä¢ t=3s   - –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ (–æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –†–µ—à–µ–Ω–∏–µ: –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ (—Å–µ–∫—É–Ω–¥—ã)                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

t=0s    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–ü—Ä–∏–≤–µ—Ç!"
        ‚îÇ
        ‚îú‚îÄ‚îÄ> 1. –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ) ‚úÖ
        ‚îÇ    [UI: "–ü—Ä–∏–≤–µ—Ç!"]
        ‚îÇ
        ‚îî‚îÄ‚îÄ> 2. AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
             ‚îî‚îÄ> action: aic_send_message
                 message: "–ü—Ä–∏–≤–µ—Ç!"
                 session_id: "session_123"

t=0.5s  –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç
        ‚îÇ
        ‚îî‚îÄ‚îÄ> response: {success: true, message_id: 42}
             ‚îÇ
             ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: lastMessageId –û–ë–ù–û–í–õ–Ø–ï–¢–°–Ø!
             ‚îÇ
             ‚îî‚îÄ‚îÄ> self.lastMessageId = Math.max(0, 42)
                  lastMessageId = 42 ‚úÖ

t=3s    Polling –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        ‚îÇ
        ‚îú‚îÄ‚îÄ> GET messages WHERE id > 42
        ‚îÇ    (lastMessageId = 42, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–ø—É—Å–∫–∞–µ–º 42)
        ‚îÇ
        ‚îî‚îÄ‚îÄ> –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: [] (–ø—É—Å—Ç–æ!)
             ‚îÇ
             ‚îî‚îÄ‚îÄ> –ù–µ—á–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å
                  [UI: "–ü—Ä–∏–≤–µ—Ç!"]
                  
                  ‚úÖ –ë–ï–ó –î–£–ë–õ–ò–ö–ê–¢–ê!

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ò–¢–û–ì: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ 1 —Ä–∞–∑              ‚îÇ
‚îÇ ‚Ä¢ t=0s   - –ø–µ—Ä–≤—ã–π —Ä–∞–∑ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ)        ‚îÇ
‚îÇ ‚Ä¢ t=3s   - –ø—Ä–æ–ø—É—â–µ–Ω–æ (id –Ω–µ > 42)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–æ (–ë–ê–ì)

```javascript
$.ajax({
    // ...
    success: function(response) {
        if (response.success && response.data) {
            self.conversationId = response.data.conversation_id;
            // ‚ùå message_id –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è!
        }
    }
});
```

### –ü–æ—Å–ª–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û)

```javascript
$.ajax({
    // ...
    success: function(response) {
        if (response.success && response.data) {
            self.conversationId = response.data.conversation_id;
            
            // ‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º lastMessageId
            if (response.data.message_id) {
                self.lastMessageId = Math.max(
                    self.lastMessageId, 
                    parseInt(response.data.message_id)
                );
                console.log('Updated lastMessageId to:', self.lastMessageId);
            }
        }
    }
});
```

## –ú–µ—Ö–∞–Ω–∏–∑–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (—É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª)

```javascript
loadMessages: function() {
    // ... AJAX –∑–∞–ø—Ä–æ—Å ...
    success: function(response) {
        response.data.messages.forEach(function(msg) {
            // ‚úÖ –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–∂–µ –±—ã–ª–∞ –≤ –∫–æ–¥–µ
            if (parseInt(msg.id) > self.lastMessageId) {
                self.addMessage(msg.message_text, msg.sender_type);
                self.lastMessageId = parseInt(msg.id);
            }
            // –ï—Å–ª–∏ msg.id <= lastMessageId, —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
        });
    }
}
```

## –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –ë—Ä–∞—É–∑–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇ   UI       ‚îÇ         ‚îÇ  JavaScript  ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  (—á–∞—Ç)     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  (widget)    ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ       ‚ñ≤                        ‚îÇ                             ‚îÇ
‚îÇ       ‚îÇ                        ‚îÇ                             ‚îÇ
‚îÇ       ‚îÇ –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ          ‚îÇ AJAX                       ‚îÇ
‚îÇ       ‚îÇ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ            ‚îÇ                             ‚îÇ
‚îÇ       ‚îÇ                        ‚ñº                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                        ‚îÇ
        ‚îÇ                        ‚îÇ
        ‚îÇ                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 ‚îÇ   –°–µ—Ä–≤–µ—Ä    ‚îÇ
        ‚îÇ                 ‚îÇ   (PHP)     ‚îÇ
        ‚îÇ                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                        ‚îÇ
        ‚îÇ                        ‚îÇ INSERT + message_id
        ‚îÇ                        ‚ñº
        ‚îÇ                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 ‚îÇ  –ë–∞–∑–∞       ‚îÇ
        ‚îÇ                 ‚îÇ  –¥–∞–Ω–Ω—ã—Ö     ‚îÇ
        ‚îÇ                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚îÇ Polling (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫)
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          SELECT WHERE id > lastMessageId
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|----------|----------------|-------------------|
| –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ lastMessageId | ‚ùå –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è |
| Polling —á–µ—Ä–µ–∑ 3 —Å–µ–∫ | üî¥ –ù–∞—Ö–æ–¥–∏—Ç –¥—É–±–ª–∏–∫–∞—Ç | ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç |
| –†–µ–∑—É–ª—å—Ç–∞—Ç | ‚ùå –î–£–ë–õ–ò–ö–ê–¢ | ‚úÖ –ë–ï–ó –î–£–ë–õ–ò–ö–ê–¢–ê |

## –¢–µ—Å—Ç: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```javascript
// –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
lastMessageId = 0
messages_displayed = []

// 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
sendMessage("–ü—Ä–∏–≤–µ—Ç!")
‚Üí addMessage("–ü—Ä–∏–≤–µ—Ç!")  // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ
‚Üí messages_displayed = ["–ü—Ä–∏–≤–µ—Ç!"]

// 2. –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
response = {message_id: 42}
‚Üí lastMessageId = 42  // ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ!

// 3. Polling
pollMessages()
‚Üí SELECT * WHERE id > 42
‚Üí [] (–ø—É—Å—Ç–æ)
‚Üí messages_displayed = ["–ü—Ä–∏–≤–µ—Ç!"]  // –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

// ‚úÖ –ò—Ç–æ–≥: 1 —Å–æ–æ–±—â–µ–Ω–∏–µ (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–∞)
```

## –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** - —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –¥–ª—è –ª—É—á—à–µ–≥–æ UX
2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - lastMessageId –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - polling –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ id > lastMessageId
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç** - –¥—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã

---

**–§–∞–π–ª**: frontend-script.js
**–°—Ç—Ä–æ–∫–∏**: 182-185
**–ò–∑–º–µ–Ω–µ–Ω–∏–π**: 4 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞
**–≠—Ñ—Ñ–µ–∫—Ç**: –ü–æ–ª–Ω–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ‚úÖ
