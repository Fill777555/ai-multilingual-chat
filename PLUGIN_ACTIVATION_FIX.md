# Исправление проблемы активации плагина

## Проблема
Плагин показывал сообщение "Plugin activated", но на самом деле не активировался - таблицы в базе данных не создавались, настройки по умолчанию не устанавливались.

## Причина
Хук активации использовал `get_instance()`, который зависит от инициализации экземпляра класса через действие `plugins_loaded`. Однако хуки активации WordPress выполняются **до** действия `plugins_loaded`, что приводит к некорректной инициализации.

### Старый код (не работал):
```php
register_activation_hook(__FILE__, function() {
    $plugin = AI_Multilingual_Chat::get_instance();
    $plugin->activate();
});
```

## Решение
Создан статический метод `activate_plugin()`, который не зависит от экземпляра класса и выполняет всю необходимую инициализацию напрямую.

### Новый код (работает):
```php
register_activation_hook(__FILE__, array('AI_Multilingual_Chat', 'activate_plugin'));
```

## Что делает новый метод активации

1. **Создает 4 таблицы в базе данных:**
   - `wp_ai_chat_conversations` - для диалогов
   - `wp_ai_chat_messages` - для сообщений
   - `wp_ai_chat_translation_cache` - для кэша переводов
   - `wp_ai_chat_faq` - для часто задаваемых вопросов

2. **Добавляет все необходимые колонки и индексы:**
   - Колонки для индикаторов набора текста (typing indicators)
   - Индексы производительности для быстрых запросов

3. **Вставляет начальные данные:**
   - 2 FAQ записи по умолчанию на английском языке

4. **Устанавливает 29 опций по умолчанию:**
   - Настройки AI провайдера
   - Настройки виджета чата
   - Цветовые схемы
   - Уведомления
   - И многое другое

5. **Выполняет финализацию:**
   - Сбрасывает правила перезаписи URL
   - Логирует успешную активацию

## Тестирование
Создан тестовый скрипт `/tmp/test-activation.php`, который симулирует процесс активации WordPress и проверяет:
- ✅ Создание всех таблиц через dbDelta
- ✅ Вставку FAQ записей
- ✅ Установку всех опций
- ✅ Сброс правил перезаписи

## Технические детали

### Почему статический метод?
1. Хуки активации выполняются до `plugins_loaded`
2. Экземпляр класса может быть не готов в момент активации
3. Статические методы не требуют инициализации класса
4. Прямой доступ к глобальному `$wpdb` всегда доступен

### Обратная совместимость
Старый метод `activate()` сохранен для возможных ручных вызовов или обновлений существующих установок.

## Проверка безопасности
- ✅ Нет новых уязвимостей
- ✅ Все операции с БД используют подготовленные запросы
- ✅ Валидация синтаксиса PHP пройдена
- ✅ Функции WordPress используются корректно

## Результат
Теперь при активации плагина:
1. Создаются все необходимые таблицы
2. Устанавливаются все настройки по умолчанию
3. Плагин полностью готов к работе
4. Не требуется дополнительная настройка после активации
