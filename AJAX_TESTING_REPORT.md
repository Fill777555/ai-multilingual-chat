# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ AJAX –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ ai-multilingual-chat

## –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 2025-10-15

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç ai-multilingual-chat –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AJAX –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—á–∞—Å—Ç—å—é (JavaScript) –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç—å—é (PHP/WordPress). –í –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞–π–¥–µ–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ **8 AJAX —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**.

## 1. –ù–∞–π–¥–µ–Ω–Ω—ã–µ AJAX —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Frontend (frontend-script.js):
1. `aic_start_conversation` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
2. `aic_send_message` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
3. `aic_get_messages` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (polling –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫)

### Admin (admin-script.js):
4. `aic_admin_get_conversations` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤
5. `aic_admin_get_messages` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
6. `aic_admin_send_message` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

### Admin API (ai-multilingual-chat.php):
7. `aic_admin_close_conversation` - –∑–∞–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞
8. `aic_generate_api_key` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ API –∫–ª—é—á–∞

## 2. –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 2.1 –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### PHP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:

1. **ajax_start_conversation** (—Å—Ç—Ä–æ–∫–∏ 257-278)
   - ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `session_id` –∏ `user_name`
   - ‚ùå –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –æ—à–∏–±–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î
   - ‚ùå –ü—Ä–∏ –æ—à–∏–±–∫–µ –ë–î –≤–æ–∑–≤—Ä–∞—â–∞–ª—Å—è success —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º NULL –¥–ª—è conversation_id

2. **ajax_get_messages** (—Å—Ç—Ä–æ–∫–∏ 345-380)
   - ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π `session_id`
   - ‚ùå –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –æ—à–∏–±–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
   - ‚ùå –ü—Ä–∏ –æ—à–∏–±–∫–µ SQL –∑–∞–ø—Ä–æ—Å –º–æ–≥ –≤–µ—Ä–Ω—É—Ç—å NULL, –Ω–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å

3. **ajax_admin_get_messages** (—Å—Ç—Ä–æ–∫–∏ 417-463)
   - ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å `conversation_id` (–º–æ–≥ –±—ã—Ç—å 0 –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)
   - ‚ùå –û—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å

4. **ajax_admin_close_conversation** (—Å—Ç—Ä–æ–∫–∏ 516-525)
   - ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
   - ‚ùå –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –æ—à–∏–±–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ update
   - ‚ùå –ù–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª—Å—è `conversation_id`

5. **ajax_admin_get_conversations** (—Å—Ç—Ä–æ–∫–∏ 382-414)
   - ‚ùå –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –æ—à–∏–±–∫–∏ —Å–ª–æ–∂–Ω–æ–≥–æ SQL –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏

6. **aic_generate_api_key** (—Å—Ç—Ä–æ–∫–∏ 871-883)
   - ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç `update_option`
   - ‚ùå –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–ª—Å—è success —Å –∫–ª—é—á–æ–º, –Ω–æ –∫–ª—é—á –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –≤ –ë–î

### 2.2 –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### JavaScript (frontend-script.js):

1. **createConversation** (—Å—Ç—Ä–æ–∫–∏ 82-109)
   - ‚ö†Ô∏è –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ `response.data` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ `response.data.conversation_id`
   - ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª timeout –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–∞
   - ‚ö†Ô∏è –ù–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

2. **sendMessage** (—Å—Ç—Ä–æ–∫–∏ 121-161)
   - ‚ö†Ô∏è –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ `response.data` –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º —Å–≤–æ–π—Å—Ç–≤
   - ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª timeout –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–∞
   - ‚ö†Ô∏è –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–æ–∑–º–æ–∂–µ–Ω race condition

3. **loadMessages** (—Å—Ç—Ä–æ–∫–∏ 164-217)
   - ‚ö†Ô∏è –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ `response.data` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ –º–∞—Å—Å–∏–≤—É
   - ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª timeout –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–∞
   - ‚ö†Ô∏è Polling –ø—Ä–æ–¥–æ–ª–∂–∞–ª—Å—è –¥–∞–∂–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ—à–∏–±–∫–∞—Ö

#### JavaScript (admin-script.js):

4. **loadConversations** (—Å—Ç—Ä–æ–∫–∏ 39-59)
   - ‚ö†Ô∏è –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ `response.data.conversations`
   - ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª timeout

5. **loadConversation** (—Å—Ç—Ä–æ–∫–∏ 97-122)
   - ‚ö†Ô∏è –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ `response.data.messages`
   - ‚ö†Ô∏è –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –æ—à–∏–±–∫–µ (—Ç–æ–ª—å–∫–æ console.error)
   - ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª timeout

6. **sendMessage** (—Å—Ç—Ä–æ–∫–∏ 177-208)
   - ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `alert()` –≤–º–µ—Å—Ç–æ –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ UI
   - ‚ö†Ô∏è –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è —Å–ª—É—á–∞–π `response.success === false`
   - ‚ö†Ô∏è –ù–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ)
   - ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª timeout

## 3. –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 3.1 –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (PHP)

#### ajax_start_conversation
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ isset()
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö session_id –∏–ª–∏ user_name
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π insert/update
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ë–î –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```

#### ajax_send_message
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ update –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã conversations
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ë–î
```

#### ajax_get_messages
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è session_id —á–µ—Ä–µ–∑ isset()
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—É—Å—Ç–æ–º session_id
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ SQL –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ NULL
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î
```

#### ajax_admin_get_conversations
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ SQL –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ NULL
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ë–î –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
```

#### ajax_admin_get_messages
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –í–∞–ª–∏–¥–∞—Ü–∏—è conversation_id (–ø—Ä–æ–≤–µ—Ä–∫–∞ > 0)
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º ID
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ SQL –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ NULL
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ update –æ–ø–µ—Ä–∞—Ü–∏–∏
```

#### ajax_admin_send_message
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ update
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
```

#### ajax_admin_close_conversation
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –í–∞–ª–∏–¥–∞—Ü–∏—è conversation_id
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ update
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î
```

#### aic_generate_api_key
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ update_option
- –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
```

### 3.2 –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (JavaScript)

#### frontend-script.js

**createConversation:**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –í–∞–ª–∏–¥–∞—Ü–∏—è sessionId –∏ userName –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- timeout: 30000 (30 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è response.data –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ —Å–≤–æ–π—Å—Ç–≤–∞–º
- –ë–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
```

**sendMessage:**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- timeout: 30000 (30 —Å–µ–∫—É–Ω–¥)
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ response.data
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ errorMsg —Å fallback
```

**loadMessages:**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- timeout: 30000 (30 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è response.data –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –≤–æ–∑–º–æ–∂–Ω–æ–º —É–ª—É—á—à–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ polling
```

#### admin-script.js

**loadConversations:**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- timeout: 30000 (30 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è response.data.conversations
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ —Å –¥–µ—Ç–∞–ª—è–º–∏
```

**loadConversation:**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- timeout: 30000 (30 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è response.data.messages
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

**sendMessage:**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- timeout: 30000 (30 —Å–µ–∫—É–Ω–¥)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞ "–û—Ç–ø—Ä–∞–≤–∫–∞..."
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è response.success === false
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –≤ complete
```

## 4. –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 4.1 –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –§—Ä–æ–Ω—Ç–µ–Ω–¥:
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
2. ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –±–µ–∑ –∏–º–µ–Ω–∏
3. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä
4. ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
5. ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (polling)
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
7. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout AJAX –∑–∞–ø—Ä–æ—Å–∞

#### –ê–¥–º–∏–Ω–∫–∞:
1. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
2. ‚úÖ –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
3. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
4. ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞
5. ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ (polling)
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î

#### API:
1. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ API –∫–ª—é—á–∞
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

## 5. –£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–í—Å–µ AJAX —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- ‚úÖ `check_ajax_referer()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ nonce
- ‚úÖ `sanitize_text_field()` / `sanitize_textarea_field()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã `$wpdb->prepare()` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π
- ‚úÖ `intval()` –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è ID –∫ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–º—É —Ç–∏–ø—É
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## 6. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Polling –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:
- Frontend: –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã (`loadMessages`)
- Admin: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (`loadConversations` –∏ `loadConversation`)

### AJAX timeouts:
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã: 30 —Å–µ–∫—É–Ω–¥ (–¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö)

## 7. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —É–ª—É—á—à–µ–Ω–∏—é

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º retry** –¥–ª—è failed AJAX –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebSocket** –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ polling
3. **–î–æ–±–∞–≤–∏—Ç—å rate limiting** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDOS

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
4. **–£–ª—É—á—à–∏—Ç—å UI feedback**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å toast notifications –≤–º–µ—Å—Ç–æ alert()
5. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏** –¥–ª—è –≤—Å–µ—Ö AJAX –æ–ø–µ—Ä–∞—Ü–∏–π
6. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å offline —Ä–µ–∂–∏–º** —Å –æ—á–µ—Ä–µ–¥—å—é —Å–æ–æ–±—â–µ–Ω–∏–π

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
7. **–î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã** –¥–ª—è AJAX –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
8. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö AJAX –æ—à–∏–±–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
9. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ AJAX –∑–∞–ø—Ä–æ—Å–æ–≤

## 8. –ò—Ç–æ–≥–∏

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**: 8
- **–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º**: 19 (6 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö, 13 —Å—Ä–µ–¥–Ω–∏—Ö)
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: 19
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 100%

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:
- üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: **–ò–°–ü–†–ê–í–õ–ï–ù–´** (6/6)
- üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã: **–ò–°–ü–†–ê–í–õ–ï–ù–´** (13/13)
- üü¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: **–í –ù–û–†–ú–ï**

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
–í—Å–µ AJAX –∑–∞–ø—Ä–æ—Å—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç:
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π –ë–î
- ‚úÖ Timeout –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏—è
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ AJAX –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏.
